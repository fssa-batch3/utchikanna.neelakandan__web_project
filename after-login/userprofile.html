<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="../assets/images/Cinephile.png"
  />
    <title>User Profile</title>
    <link rel="stylesheet" href="../after-login/assets/css/userprofile.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="wholeprofilecontainer">
     
      <div class="userdetails">
        <h1 class="profileh1">Personal Details</h1>
        <form id="form">
          <div class="flex_form">
          <div class="user_details2">
              <label for="name">First Name</label><br />
              <input
                autocomplete="off"
                required="true"
                pattern="[A-Za-z]{1,32}"
                type="text"
                id="name"
                placeholder=" enter your name"
              /><br />
            
              <label for="surname">Last name</label><br />
              <input
                autocomplete="off"
                required="true"
                pattern="[A-Za-z]{1,32}"
                type="text"
                class="surname"
                id="surname"
                placeholder=" enter your last name"
              /><br />
            
          <label for="emailid">Email ID</label><br />
          <input
            autocomplete="off"
            required="true"
            type="email"
            class="emailid"
            id="emailid"
            placeholder=" enter your Email ID"
          /><br />
          <label for="mobilenumber">Mobile Number</label><br />
          <input
             autocomplete="off"
             required="true"
            type="tel"
            class="mobilenumber"
            id="mobilenumber"
            placeholder=" enter your mobilenumber"
          /><br />
        </div>
          <div class="user_details1">
          <label for="addressline1">Date of Brith</label><br />
          <input
            autocomplete="off"
            required="true"
            type="date"
            class="addressline1"
            id="dob"
          /><br />
          <label for="addressline1">Gender</label><br />
          <select autocomplete="off"
             required="true" id="gender" name="gender">
            <option value="female">Female</option>
            <option value="male">Male</option>
            <option value="non-binary">Non-Binary</option>
            <option value="other">Other</option>
            <option value="Prefer not to answer">Perfer not to Answer</option>
            </select>
      <br />
          <label for="state">State</label><br />
          <input
            autocomplete="off"
            required="true"
            pattern="[A-Za-z]{1,32}"
            type="text"
            class="state"
            id="state"
            placeholder=" enter your State"
          /><br />
          
  
              <label for="country">Country</label><br />
              <input
                autocomplete="off"
                required="true"
                pattern="[A-Za-z]{1,32}"
                type="text"
                class="country"
                id="country"
                placeholder="Country"
              /><br />
           
          </div>  
        </div>
            <button type="submit"  class="btn6">Submit</button>
            <button type="delete" id="delete"  class="btn6">Delete Details</button>
          </form>
          <a href="../after-login/index.html">
          <button  class="submit" >Back</button>
        </a>
     

      
    <script>
      const user_email = JSON.parse(window.localStorage.getItem("details"))
     
      const user_details = JSON.parse(window.localStorage.getItem("user"))
      let get_obj = user_details.find(function(user_obj){
        let check_email = user_obj["email"]
        if(user_email===check_email){   
          return true ;
        }
      });
      console.log(get_obj)

      const fname = document.getElementById("name");
      const lname = document.getElementById("surname");
      const mail = document.getElementById("emailid");
      const phone = document.getElementById("mobilenumber");
      // const dob = document.getElementById("dob");
      // const state = document.getElementById("state");  
      // const country = document.getElementById("country"); 
      // const gender  = document.getElementById("gender"); 

      fname.value =  get_obj["fname"] ;
      lname.value =  get_obj["lname"] ;
      mail.value  =  user_email ;
      phone.value =  get_obj["phone_no"] ;
      // dob.value =  get_obj[" _"] ;
      // state.value = get_obj [" _"] ;
      // country.value =  get_obj[" _"] ;
      // gender.value =  get_obj[" _"] ;
     


  
      let form = document.getElementById("form");
      form.addEventListener("submit" , function(event){
      event.preventDefault()
      let fname = document.getElementById("name").value;
      let lname = document.getElementById("surname").value;
      let mail = document.getElementById("emailid").value;
      let phone = document.getElementById("mobilenumber").value;
      let dob = document.getElementById("dob").value;
      let state = document.getElementById("state").value;  
      let country = document.getElementById("country").value; 
      let gender  = document.getElementById("gender").value; 
      
      let new_data = {
        fname,
        lname,
        mail,
        phone,
        dob,
        state,
        country,
        gender,
      };
      // if( mail.value != user_email ){
      //   alert("You can't change the email-id")
      //   return 
      // }
    
    let updates = Object.assign(get_obj,new_data);
    console.log(updates); 

    let index = user_details.indexOf(get_obj) 
     console.log(index);

    user_details[index] = updates; 

    localStorage.setItem("user", JSON.stringify(user_details))

    alert("You have successfully updated your account details!");

    location.reload()

    });

    // const user_email = JSON.parse(window.localStorage.getItem("details"))
    let check = true;
     const present_details = JSON.parse(window.localStorage.getItem("user"))
      let get_present = user_details.find(function(user_obj){
        let check_email = user_obj["email"]
        if(user_email===check_email){ 
              
      let fname1 = document.getElementById("name");
      let lname1 = document.getElementById("surname");
      let mail1 = document.getElementById("emailid");
      let phone1 = document.getElementById("mobilenumber");
      let dob1 = document.getElementById("dob");
      let state1 = document.getElementById("state");  
      let country1 = document.getElementById("country"); 
      let gender1  = document.getElementById("gender");

      fname1.value  = user_obj["fname"];
      lname1.value  = user_obj["lname"];
      mail1.value  = user_obj["email"];
      phone1.value  = user_obj["phone_no"];
      dob1.value  = user_obj["dob"];
      state1.value  = user_obj["state"];
      country1.value  = user_obj["country"];
      gender1.value  = user_obj["gender"];  
      
     }    
      });

 
      let delete_user = document.getElementById("delete") 
      delete_user.addEventListener("click" , function(event){   
      event.preventDefault()
      let index = user_details.indexOf(get_obj)
      let msg =  confirm("Are you sure you want to delete this account")
      if(msg !== true){
        return   
      } else{ 
        user_details.splice(index,1)
        console.log(user_details);
        localStorage.setItem("user",JSON.stringify(user_details))
        window.location.href ="../pages/signUp.html";
      }
    });
    </script>
  </body>
</html>
